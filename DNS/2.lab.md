# Cấu hình DNS Server trên CentOS 7

## Cài đặt DNS server

Kịch bản: 

Trong bài lab này có 3 node, 1 node là Master DNS server, 1 node là Slave DNS server, 1 node là Client

Mô hình:

![Imgur](https://i.imgur.com/2JiSSrO.png)

### Cài đặt Master DNS server

Cài các gói bind9

    yum install bind bind-utils -y

1. Cấu hình DNS Server

Sửa file `/etc/named.conf`

    vi /etc/named.conf

Trong phần options, sửa các dòng:

    listen-on port 53 { 127.0.0.1; 10.10.34.171;}; ### Master DNS IP ###
    allow-query     { localhost; 10.10.34.0/24;}; ### IP Range ###
    allow-transfer{ localhost; 10.10.34.176; };   ### Slave DNS IP ###

Và thêm các dòng sau vào cuối file

    zone "dung.db" IN {
    type master;
    file "forward.dung";
    allow-update { none; };
    };
    zone "34.10.10.in-addr.arpa" IN {
    type master;
    file "reverse.dung";
    allow-update { none; };
    };

2. Tạo file forward và reverse zone mà ta đã nêu trong file `/etc/named.conf`

Tạo file `forward.dung` trong thư mục `/var/named`

    vi /var/named/forward.dung

Thêm vào nội dung

    $TTL 86400
    @   IN  SOA     masterdns.dung.db. root.dung.db. (
            2011071001  ;Serial
            3600        ;Refresh
            1800        ;Retry
            604800      ;Expire
            86400       ;Minimum TTL
    )
    @       IN  NS          masterdns.dung.db.
    @       IN  NS          secondarydns.dung.db.
    @       IN  A           10.10.34.171
    @       IN  A           10.10.34.176
    @       IN  A           10.10.34.174
    masterdns       IN  A   10.10.34.171
    secondarydns    IN  A   10.10.34.176
    client          IN  A   10.10.34.174

Tạo file `reverse.dung` trong thư mục `/var/named`

    vi /var/named/reverse.dung

Nội dung

    $TTL 86400
    @   IN  SOA     masterdns.dung.db. root.dung.db. (
            2011071001  ;Serial
            3600        ;Refresh
            1800        ;Retry
            604800      ;Expire
            86400       ;Minimum TTL
    )
    @       IN  NS          masterdns.dung.db.
    @       IN  NS          secondarydns.dung.db.
    @       IN  PTR         dung.db.
    masterdns       IN  A   10.10.34.171
    secondarydns    IN  A   10.10.34.176
    client          IN  A   10.10.34.174
    171     IN  PTR         masterdns.dung.db.
    176     IN  PTR         secondarydns.dung.db.
    174     IN  PTR         client.dung.db.

3. Khởi động dịch vụ DNS

        systemctl enable named
        systemctl start named

4. Cấu hình firewall

        firewall-cmd --permanent --add-port=53/tcp
        firewall-cmd --permanent --add-port=53/udp
        firewall-cmd --reload

5. Phân quyền, quyền sở hữu

        chgrp named -R /var/named
        chown -v root:named /etc/named.conf
        restorecon -rv /var/named
        restorecon /etc/named.conf

6. Test cấu hình 

Check cấu hình mặc định:

    named-checkconf /etc/named.conf

Nếu không có thông báo gì là OK

Check Forward zone:

    named-checkzone dung.db /var/named/forward.dung

Check reverse zone:

    named-checkzone dung.db /var/named/reverse.dung

Output mẫu:

![Imgur](https://i.imgur.com/Ofjea9s.png)

Sau đó sửa cấu hình DNS của interface đang sử dụng

    vi /etc/sysconfig/network-scripts/ifcfg-eth0

    # Generated by dracut initrd
    NAME="eth0"
    HWADDR="52:54:00:6F:58:F6"
    ONBOOT="yes"
    NETBOOT="yes"
    UUID="2f4c9fa1-1511-4da5-912b-2f2d66029920"
    IPV6INIT="yes"
    BOOTPROTO="static"
    TYPE="Ethernet"
    PROXY_METHOD="none"
    BROWSER_ONLY="no"
    DEFROUTE="yes"
    IPV4_FAILURE_FATAL="no"
    IPV6_AUTOCONF="yes"
    IPV6_DEFROUTE="yes"
    IPV6_FAILURE_FATAL="no"
    IPADDR=10.10.34.171
    PREFIX=24
    GATEWAY=10.10.34.1
    DNS=10.10.34.171

Sửa file `/etc/resolv.conf`

    vi /etc/resolv.conf

Thêm IP của name server

    nameserver 10.10.34.171

![Imgur](https://i.imgur.com/qGU3B8W.png)

Restart dịch vụ mạng

    systemctl restart network

7. Kiểm tra DNS server 

        dig masterdns.dung.db

![Imgur](https://i.imgur.com/7K1n2xK.png)

    nslookup dung.db

![Imgur](https://i.imgur.com/aQhGUdy.png)

Như vậy ta đã cấu hình xong Primary Name Server (Master)

Bây giờ cấu cài đặt và cấu hình Secondary Name Server (Slave)

### Cấu hình Slave DNS Server

Cài các gói bind9

    yum install bind bind-utils -y

1. Cấu hình DNS Server

Sửa file `/etc/named.conf`

    vi /etc/named.conf

Trong phần options, sửa các dòng:

    listen-on port 53 { 127.0.0.1; 10.10.34.176; };
    allow-query     { localhost; 10.10.34.0/24;  };

Và thêm các dòng sau vào cuối file

    zone "dung.db" IN {
    type slave;
    file "slaves/dung.fwd";
    masters { 10.10.34.171; };
    };
    zone "34.10.10.in-addr.arpa" IN {
    type slave;
    file "slaves/dung.rev";
    masters { 10.10.34.171; };
    };

2. Khởi động dịch vụ

        systemctl enable named
        systemctl start named

Bây giờ forward và reverse zone sẽ được tự động cập nhật từ Master DNS server sang file `/var/named/slaves/` của Secondary DNS server

    ls /var/named/slaves/

![Imgur](https://i.imgur.com/ccJLdSr.png)

3. Thêm thông tin DNS vào file cấu hình interface đang sử dụng

        vi /etc/sysconfig/network-scripts/ifcfg-eth1

Thêm thông tin DNS

    DNS1=10.10.34.171
    DNS2=10.10.34.176

![Imgur](https://i.imgur.com/lU2wjvn.png)

Khởi động lại dịch vụ mạng

    systemctl restart network

4. Cấu hình firewall

        firewall-cmd --permanent --add-port=53/tcp
        firewall-cmd --permanent --add-port=53/udp
        firewall-cmd --reload

5. Phân quyền, quyền sở hữu

        chgrp named -R /var/named
        chown -v root:named /etc/named.conf
        restorecon -rv /var/named
        restorecon /etc/named.conf
6. Test DNS server 

        dig masterdns.dung.db

![Imgur](https://i.imgur.com/gkzriRA.png)

    dig secondarydns.dung.db

![Imgur](https://i.imgur.com/gc85dZE.png)

    nslookup dung.db

![Imgur](https://i.imgur.com/QcZD6XM.png)

### Cấu hình trên Client

    vi /etc/resolv.conf

    search dung.db
    nameserver 10.10.34.171
    nameserver 10.10.34.176

![Imgur](https://i.imgur.com/O7LqDyH.png)

Khởi động lại dịch vụ mạng và reboot máy

    systemctl restart network
    reboot

Test DNS server:

    dig masterdns.dung.db

![Imgur](https://i.imgur.com/K9naYjL.png)

    dig secondarydns.dung.db

![Imgur](https://i.imgur.com/pBwYYC4.png)

    dig client.dung.db

![Imgur](https://i.imgur.com/PWcmp6y.png)

    nslookup dung.db

![Imgur](https://i.imgur.com/fBtLXME.png)

Xóa 2 dòng sau trong file `/var/named/forward.dung`

    @       IN  A           10.10.34.174
    client          IN  A   10.10.34.174

Khởi động lại dịch vụ dns

    systemctl restart named

Chạy lệnh:

    dig dung.db

![Imgur](https://i.imgur.com/SsSlAgi.png)

Thử tắt DNS1 10.10.34.171

    dig dung.db

![Imgur](https://i.imgur.com/L5ILWPi.png)

Như ta thấy thì sau khi tắt DNS1, các thông tin truy vấn sẽ được đưa từ DNS2 về. Do DNS2 chưa kịp cập nhật thông tin do chưa hết thời gian Refresh nên ta sẽ thấy vẫn còn thông tin client.

## Tham khảo: 

https://www.unixmen.com/setting-dns-server-centos-7/

## Bổ sung

Đầu tiên đọc cách thức DNS hoạt động: https://news.cloud365.vn/hoat-dong-cua-he-thong-dns/

Ta thêm một host làm web server vào bài lab này

Mô hình:

![Imgur](https://i.imgur.com/ynuEZsL.png)

Thêm bản ghi www trỏ về webserver 10.10.34.179

```
[root@wp ~]# cat /var/named/forward.dung
$TTL 86400
@   IN  SOA     masterdns.dung.db. root.dung.db. (
        2011071001  ;Serial
        3600        ;Refresh
        1800        ;Retry
        604800      ;Expire
        86400       ;Minimum TTL
)
@       IN  NS          masterdns.dung.db.
@       IN  NS          secondarydns.dung.db.
@       IN  A           10.10.34.171
@       IN  A           10.10.34.176
masterdns       IN  A   10.10.34.171
secondarydns    IN  A   10.10.34.176
client          IN  A   10.10.34.174
www  IN   A   10.10.34.179
dung.db  IN   A      10.10.34.179
[root@wp ~]#
```

```
[root@wp ~]# cat /var/named/reverse.dung
$TTL 86400
@   IN  SOA     masterdns.dung.db. root.dung.db. (
        2011071001  ;Serial
        3600        ;Refresh
        1800        ;Retry
        604800      ;Expire
        86400       ;Minimum TTL
)
@       IN  NS          masterdns.dung.db.
@       IN  NS          secondarydns.dung.db.
@       IN  PTR         dung.db.
masterdns       IN  A   10.10.34.171
secondarydns    IN  A   10.10.34.176
www          IN  A   10.10.34.179
171     IN  PTR         masterdns.dung.db.
176     IN  PTR         secondarydns.dung.db.
174     IN  PTR         client.dung.db.
179     IN  PTR         www.dung.db
[root@wp ~]#
```

Đứng tại DNS1, bắt gói tin trên port 53 bằng tcpdump

    tcpdump port 53 -w dns.pcap

Đứng tại client 10.10.34.174, chạy các lệnh sau

    dig www.dung.db

Kết quả:
```
[root@client ~]# dig www.dung.db

; <<>> DiG 9.11.4-P2-RedHat-9.11.4-16.P2.el7_8.6 <<>> www.dung.db
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 29604
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 2, ADDITIONAL: 3

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;www.dung.db.                   IN      A

;; ANSWER SECTION:
www.dung.db.            86400   IN      A       10.10.34.179

;; AUTHORITY SECTION:
dung.db.                86400   IN      NS      secondarydns.dung.db.
dung.db.                86400   IN      NS      masterdns.dung.db.

;; ADDITIONAL SECTION:
masterdns.dung.db.      86400   IN      A       10.10.34.171
secondarydns.dung.db.   86400   IN      A       10.10.34.176

;; Query time: 2 msec
;; SERVER: 10.10.34.171#53(10.10.34.171)
;; WHEN: Thu Sep 03 22:35:26 +07 2020
;; MSG SIZE  rcvd: 139

[root@client ~]#
```

    dig dung.db

Kết quả:
```
[root@client ~]# dig dung.db

; <<>> DiG 9.11.4-P2-RedHat-9.11.4-16.P2.el7_8.6 <<>> dung.db
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 29828
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 2, ADDITIONAL: 3

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;dung.db.                       IN      A

;; ANSWER SECTION:
dung.db.                86400   IN      A       10.10.34.176
dung.db.                86400   IN      A       10.10.34.171

;; AUTHORITY SECTION:
dung.db.                86400   IN      NS      secondarydns.dung.db.
dung.db.                86400   IN      NS      masterdns.dung.db.

;; ADDITIONAL SECTION:
masterdns.dung.db.      86400   IN      A       10.10.34.171
secondarydns.dung.db.   86400   IN      A       10.10.34.176

;; Query time: 1 msec
;; SERVER: 10.10.34.171#53(10.10.34.171)
;; WHEN: Thu Sep 03 22:36:27 +07 2020
;; MSG SIZE  rcvd: 151

[root@client ~]#
```

    dig +trace www.dung.db

Kết quả:
```
[root@client ~]# dig +trace www.dung.db

; <<>> DiG 9.11.4-P2-RedHat-9.11.4-16.P2.el7_8.6 <<>> +trace www.dung.db
;; global options: +cmd
.                       491561  IN      NS      k.root-servers.net.
.                       491561  IN      NS      f.root-servers.net.
.                       491561  IN      NS      l.root-servers.net.
.                       491561  IN      NS      i.root-servers.net.
.                       491561  IN      NS      h.root-servers.net.
.                       491561  IN      NS      m.root-servers.net.
.                       491561  IN      NS      c.root-servers.net.
.                       491561  IN      NS      e.root-servers.net.
.                       491561  IN      NS      d.root-servers.net.
.                       491561  IN      NS      b.root-servers.net.
.                       491561  IN      NS      g.root-servers.net.
.                       491561  IN      NS      j.root-servers.net.
.                       491561  IN      NS      a.root-servers.net.
.                       491561  IN      RRSIG   NS 8 0 518400 20200916050000 20200903040000 46594 . vj5xxRVUT88dWe5Z2qnZGiISQ1egnOZmKPGd3gFNk/3t529veapIY5Fl aeKFP/a1HQpE53ixB7XPl7L4uVXPc/RMPUnDa4UuhktgCT1F7vR59w/P bvTp8/oo+gJSzvgQSKO22y/xoP9gE1JjUF/paE59IPtP6YU1wgbZFXK+ jR4uMRq5eDq0FE3s6dSBonQgWQAGJ0wU18HeQHfUHFiTtYVWdbabLbvn lGnLRICbF5obDQn+gqolQKMehmMut6S9ucDgqHLkq+lQQVo2obg5NYEX 3Bt4M9QOlGzCraagpqNZPGPMF6ah+tX4xuuns98C+9CKj3EEYQzs9AgB 0N4SKA==
;; Received 1097 bytes from 10.10.34.171#53(10.10.34.171) in 1 ms

.                       86400   IN      SOA     a.root-servers.net. nstld.verisign-grs.com. 2020090300 1800 900 604800 86400
.                       86400   IN      RRSIG   SOA 8 0 86400 20200916050000 20200903040000 46594 . x4bSwMQCvJJGyu+2HNtZXALVhHK7JZ7RHiGW728XAAFtp5Gf+IzFitdF JhEkzLDpE5TSlbykuNTIxH8Chz5lfIrCfDUwDt8k8MtYhx1Gt9s7B8Xv ACx7kPykugehIQZzlTNMXLjptXpd83wnUcIy2jfvagprQym+k+wyohIr Rl3JAzJ8NOF+c1mXPzlxLZypFE95Dyj52W2sbFPyeEuGqlbmqjEZHXtU M19U7ew6DP5YAFomN/N5q4nziolwevDAoBES1pXe0Pt90y+60mFtri+p lZgqKq0TRdFdwv1PA7/kEYeAXiLIOd/YPb+q6pDhEgvL2n0jPX4LCZZH O+KxCQ==
.                       86400   IN      NSEC    aaa. NS SOA RRSIG NSEC DNSKEY
.                       86400   IN      RRSIG   NSEC 8 0 86400 20200916050000 20200903040000 46594 . qHE5pGQcC2hPCRrEfTYvmaHzDArfkZgXWqYl/dOEwFYBJ4vn6+zPC4pD dVjsT7fyeg9P1h48pE6UICv4VMxMsItwO13TzXM0jejEY5YHqyv/Oerv +Zuh6zP4xHRpjKLIggPxV5Xn8GmAHddjaW3HG/ZhdqrSubRlW491ZBis wc/A3Y+DP3K8YGYnL+fBb7ZFKD54fqdh20McyXe0E08KSTXcAHf2Lpvw n+H8ZbXtzMeyJX9K771diK8H9Ni/Mn+wgtkspMgDA/+eRVeRrIB9BbPk HdZQY8LYCIYH3ZuNmQmdTZfBe5APiCfv/3vx5B6Iw3PrsaKJ0rPJ66/w lUbFbw==
day.                    86400   IN      NSEC    dclk. NS DS RRSIG NSEC
day.                    86400   IN      RRSIG   NSEC 8 1 86400 20200916050000 20200903040000 46594 . t4+LZBGtusg59C/fbKaqbKg3PxeEgwKxF75EVyJuJJo+DqiL38dPBWRG aCDlN/Ym84LourbIU1BL7hki3xEiyeUz6WWiCydlGoutj561wWmvvevc UgTMR6pjC+8jj6Bna3fZEUwJ12+iGpJMEbURS6SgQS2idwx2knUAI4ek xaaxUtPEFsoFARFnh8+7+cYvyNbwx9ZW/CZx1rI2UQ1cU3FJ7e8gjuoD G0QwdnzUPoqHW0HRG1xb1VyJ/zHHzqnpTAGOkdMENGwPRgK8Oi7S9KxK Z0xIxm3+Nt/TM2F5TYT2+pfWowrRgqRSSRvy/loHi/hopSqZ5s88h/fN fwv+wg==
;; Received 1028 bytes from 199.9.14.201#53(b.root-servers.net) in 175 ms

[root@client ~]#
```
    nslookup www.dung.db

Kết quả:    
```
[root@client ~]# nslookup www.dung.db
Server:         10.10.34.171
Address:        10.10.34.171#53

Name:   www.dung.db
Address: 10.10.34.179

[root@client ~]#
```
### Phân tích gói tin bắt được bằng wireshark

+ Đối với lệnh `dig www.dung.db`. Ta bắt được 2 gói tin

![Imgur](https://i.imgur.com/93wmxeM.png)

Client 10.10.34.174 sẽ truy vấn, DNS1 10.10.34.171 trả về kết quả IP 10.10.34.179 của webserver

+ Đối với lệnh `dig dung.db` cũng tương tự, bắt được 2 gói tin

![Imgur](https://i.imgur.com/qqhWbrq.png)

Client 10.10.34.174 sẽ truy vấn, DNS1 10.10.34.171 trả về kết quả IP của DNS1 và DNS2

+ Đối với lệnh `nslookup www.dung.db`, bắt được 4 gói tin

![Imgur](https://i.imgur.com/mjePpiJ.png)

Client 10.10.34.174 sẽ truy vấn, DNS1 10.10.34.171 trả về kết quả IP 10.10.34.179 của webserver. Ngoài ra còn trả về thông tin SOA

+ Đối với lệnh `dig +trace www.dung.db`, ta đã thấy kết quả trả về không có IP của webserver vì đây là tên miền không có thực nên các ROOT DNS server sẽ không tìm thấy. 

Các bản ghi ta thhu thập được là các truy vấn từ client đến DNS1, sau đó DNS1 sẽ truy vấn đến các ROOT DNS server

![Imgur](https://i.imgur.com/Va4M12E.png)

### Bắt gói tin bằng lệnh `dig` với option `+trace` với một tên miền google.com

Đứng tại Client 10.10.34.174 bắt gói tin

    tcpdump port 53 -w google.pcap

Và thực hiện lệnh

    dig +trace google.com

Kết quả:

```
[root@client ~]# dig +trace google.com

; <<>> DiG 9.11.4-P2-RedHat-9.11.4-16.P2.el7_8.6 <<>> +trace google.com
;; global options: +cmd
.                       490619  IN      NS      h.root-servers.net.
.                       490619  IN      NS      e.root-servers.net.
.                       490619  IN      NS      l.root-servers.net.
.                       490619  IN      NS      c.root-servers.net.
.                       490619  IN      NS      g.root-servers.net.
.                       490619  IN      NS      a.root-servers.net.
.                       490619  IN      NS      d.root-servers.net.
.                       490619  IN      NS      j.root-servers.net.
.                       490619  IN      NS      k.root-servers.net.
.                       490619  IN      NS      f.root-servers.net.
.                       490619  IN      NS      b.root-servers.net.
.                       490619  IN      NS      i.root-servers.net.
.                       490619  IN      NS      m.root-servers.net.
.                       490619  IN      RRSIG   NS 8 0 518400 20200916050000 20200903040000 46594 . vj5xxRVUT88dWe5Z2qnZGiISQ1egnOZmKPGd3gFNk/3t529veapIY5Fl aeKFP/a1HQpE53ixB7XPl7L4uVXPc/RMPUnDa4UuhktgCT1F7vR59w/P bvTp8/oo+gJSzvgQSKO22y/xoP9gE1JjUF/paE59IPtP6YU1wgbZFXK+ jR4uMRq5eDq0FE3s6dSBonQgWQAGJ0wU18HeQHfUHFiTtYVWdbabLbvn lGnLRICbF5obDQn+gqolQKMehmMut6S9ucDgqHLkq+lQQVo2obg5NYEX 3Bt4M9QOlGzCraagpqNZPGPMF6ah+tX4xuuns98C+9CKj3EEYQzs9AgB 0N4SKA==
;; Received 1097 bytes from 10.10.34.171#53(10.10.34.171) in 1 ms

com.                    172800  IN      NS      a.gtld-servers.net.
com.                    172800  IN      NS      b.gtld-servers.net.
com.                    172800  IN      NS      c.gtld-servers.net.
com.                    172800  IN      NS      d.gtld-servers.net.
com.                    172800  IN      NS      e.gtld-servers.net.
com.                    172800  IN      NS      f.gtld-servers.net.
com.                    172800  IN      NS      g.gtld-servers.net.
com.                    172800  IN      NS      h.gtld-servers.net.
com.                    172800  IN      NS      i.gtld-servers.net.
com.                    172800  IN      NS      j.gtld-servers.net.
com.                    172800  IN      NS      k.gtld-servers.net.
com.                    172800  IN      NS      l.gtld-servers.net.
com.                    172800  IN      NS      m.gtld-servers.net.
com.                    86400   IN      DS      30909 8 2 E2D3C916F6DEEAC73294E8268FB5885044A833FC5459588F4A9184CF C41A5766
com.                    86400   IN      RRSIG   DS 8 1 86400 20200916050000 20200903040000 46594 . gmKbJROq460Et1beetBoJ68rO2Z7CM0S+Yx84+YxyDjimH5PC44eJNId J4gKuVeX4tfa0tNaG03ahVGLDDQGhqIK0dKrhBz4zqnkjH9tkqBqaBJX YIduvpGpbYo6TF64M/oOqjjKLGSV+sK2CX3d8eWvLrdw9qDn3Lx5UzIx cSGWx+NK5L1eiIHbPgD3a1fs3luZZYE5oPEZFztUn0yU3+cQbgXMQYki +qX59ALrpKPgOLNOHwtiIgrkzvPShW+IBNGxZI7DP7js/ms3OaiZcJO9 VqQr8ZRQu3sUBTpdKATy7SU3gT7eyFbrFbhSAlqgHzNjRzCuEckR63EM 4XKn8g==
;; Received 1170 bytes from 199.7.83.42#53(l.root-servers.net) in 156 ms

google.com.             172800  IN      NS      ns2.google.com.
google.com.             172800  IN      NS      ns1.google.com.
google.com.             172800  IN      NS      ns3.google.com.
google.com.             172800  IN      NS      ns4.google.com.
CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN NSEC3 1 1 0 - CK0Q1GIN43N1ARRC9OSM6QPQR81H5M9A NS SOA RRSIG DNSKEY NSEC3PARAM
CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN RRSIG NSEC3 8 2 86400 20200910044132 20200903033132 24966 com. K6VW6C0oC+auVPTbHxy4vSc4em0hAvhlzBiLRTqiO+axNGK71dwVKNVP Kzp7ltUjiuPvNtA0FxvwR8OwN57WXO7tR7tQWaWeE7+VhqPQMYuYa6dT 3HMFHa9udTCFyG5qdOZeYCPmfOon6un4IijrJ+yyDV817BGOvRfPsmUj fpENyGNckI0m/gNJ5ZfxECSTtxEJkMOjuHlIm7ETJ+qmow==
S84BDVKNH5AGDSI7F5J0O3NPRHU0G7JQ.com. 86400 IN NSEC3 1 1 0 - S84CDVS9VPREADFD6KK7PDADH0M6IO8H NS DS RRSIG
S84BDVKNH5AGDSI7F5J0O3NPRHU0G7JQ.com. 86400 IN RRSIG NSEC3 8 2 86400 20200907043719 20200831032719 24966 com. Qz/y5/wlw9cD4mqoCqmZi7ZXL5Pg78Uudx1U54igszNNk0Jr1NVltXIB n74pjtZDZVuAY9d5C1gzfmV1mgEz6dvHWGj29NCpggDq3SDaDaO11uvG TEmwaaHCEXMJQLpPeI3SqdJOdDcmcoZSJSUoyLK3m7wv3Eel85BKwWJR N8sgoIR909T1Kj2J52nY3ZGklqQ4rZcL5MIxUpt0/K6HGA==
;; Received 836 bytes from 192.52.178.30#53(k.gtld-servers.net) in 260 ms

google.com.             300     IN      A       172.217.24.78
;; Received 55 bytes from 216.239.34.10#53(ns2.google.com) in 36 ms

[root@client ~]#
[root@client ~]# dig +trace google.com

; <<>> DiG 9.11.4-P2-RedHat-9.11.4-16.P2.el7_8.6 <<>> +trace google.com
;; global options: +cmd
.                       490417  IN      NS      m.root-servers.net.
.                       490417  IN      NS      e.root-servers.net.
.                       490417  IN      NS      k.root-servers.net.
.                       490417  IN      NS      h.root-servers.net.
.                       490417  IN      NS      c.root-servers.net.
.                       490417  IN      NS      g.root-servers.net.
.                       490417  IN      NS      f.root-servers.net.
.                       490417  IN      NS      l.root-servers.net.
.                       490417  IN      NS      b.root-servers.net.
.                       490417  IN      NS      a.root-servers.net.
.                       490417  IN      NS      j.root-servers.net.
.                       490417  IN      NS      i.root-servers.net.
.                       490417  IN      NS      d.root-servers.net.
.                       490417  IN      RRSIG   NS 8 0 518400 20200916050000 20200903040000 46594 . vj5xxRVUT88dWe5Z2qnZGiISQ1egnOZmKPGd3gFNk/3t529veapIY5Fl aeKFP/a1HQpE53ixB7XPl7L4uVXPc/RMPUnDa4UuhktgCT1F7vR59w/P bvTp8/oo+gJSzvgQSKO22y/xoP9gE1JjUF/paE59IPtP6YU1wgbZFXK+ jR4uMRq5eDq0FE3s6dSBonQgWQAGJ0wU18HeQHfUHFiTtYVWdbabLbvn lGnLRICbF5obDQn+gqolQKMehmMut6S9ucDgqHLkq+lQQVo2obg5NYEX 3Bt4M9QOlGzCraagpqNZPGPMF6ah+tX4xuuns98C+9CKj3EEYQzs9AgB 0N4SKA==
;; Received 1097 bytes from 10.10.34.171#53(10.10.34.171) in 1 ms

com.                    172800  IN      NS      a.gtld-servers.net.
com.                    172800  IN      NS      c.gtld-servers.net.
com.                    172800  IN      NS      b.gtld-servers.net.
com.                    172800  IN      NS      l.gtld-servers.net.
com.                    172800  IN      NS      i.gtld-servers.net.
com.                    172800  IN      NS      g.gtld-servers.net.
com.                    172800  IN      NS      d.gtld-servers.net.
com.                    172800  IN      NS      e.gtld-servers.net.
com.                    172800  IN      NS      h.gtld-servers.net.
com.                    172800  IN      NS      k.gtld-servers.net.
com.                    172800  IN      NS      j.gtld-servers.net.
com.                    172800  IN      NS      f.gtld-servers.net.
com.                    172800  IN      NS      m.gtld-servers.net.
com.                    86400   IN      DS      30909 8 2 E2D3C916F6DEEAC73294E8268FB5885044A833FC5459588F4A9184CF C41A5766
com.                    86400   IN      RRSIG   DS 8 1 86400 20200916050000 20200903040000 46594 . gmKbJROq460Et1beetBoJ68rO2Z7CM0S+Yx84+YxyDjimH5PC44eJNId J4gKuVeX4tfa0tNaG03ahVGLDDQGhqIK0dKrhBz4zqnkjH9tkqBqaBJX YIduvpGpbYo6TF64M/oOqjjKLGSV+sK2CX3d8eWvLrdw9qDn3Lx5UzIx cSGWx+NK5L1eiIHbPgD3a1fs3luZZYE5oPEZFztUn0yU3+cQbgXMQYki +qX59ALrpKPgOLNOHwtiIgrkzvPShW+IBNGxZI7DP7js/ms3OaiZcJO9 VqQr8ZRQu3sUBTpdKATy7SU3gT7eyFbrFbhSAlqgHzNjRzCuEckR63EM 4XKn8g==
;; Received 1170 bytes from 192.36.148.17#53(i.root-servers.net) in 44 ms

google.com.             172800  IN      NS      ns2.google.com.
google.com.             172800  IN      NS      ns1.google.com.
google.com.             172800  IN      NS      ns3.google.com.
google.com.             172800  IN      NS      ns4.google.com.
CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN NSEC3 1 1 0 - CK0Q1GIN43N1ARRC9OSM6QPQR81H5M9A NS SOA RRSIG DNSKEY NSEC3PARAM
CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN RRSIG NSEC3 8 2 86400 20200910044132 20200903033132 24966 com. K6VW6C0oC+auVPTbHxy4vSc4em0hAvhlzBiLRTqiO+axNGK71dwVKNVP Kzp7ltUjiuPvNtA0FxvwR8OwN57WXO7tR7tQWaWeE7+VhqPQMYuYa6dT 3HMFHa9udTCFyG5qdOZeYCPmfOon6un4IijrJ+yyDV817BGOvRfPsmUj fpENyGNckI0m/gNJ5ZfxECSTtxEJkMOjuHlIm7ETJ+qmow==
S84BDVKNH5AGDSI7F5J0O3NPRHU0G7JQ.com. 86400 IN NSEC3 1 1 0 - S84CDVS9VPREADFD6KK7PDADH0M6IO8H NS DS RRSIG
S84BDVKNH5AGDSI7F5J0O3NPRHU0G7JQ.com. 86400 IN RRSIG NSEC3 8 2 86400 20200907043719 20200831032719 24966 com. Qz/y5/wlw9cD4mqoCqmZi7ZXL5Pg78Uudx1U54igszNNk0Jr1NVltXIB n74pjtZDZVuAY9d5C1gzfmV1mgEz6dvHWGj29NCpggDq3SDaDaO11uvG TEmwaaHCEXMJQLpPeI3SqdJOdDcmcoZSJSUoyLK3m7wv3Eel85BKwWJR N8sgoIR909T1Kj2J52nY3ZGklqQ4rZcL5MIxUpt0/K6HGA==
;; Received 836 bytes from 192.41.162.30#53(l.gtld-servers.net) in 229 ms

google.com.             300     IN      A       172.217.24.78
;; Received 55 bytes from 216.239.38.10#53(ns4.google.com) in 184 ms

[root@client ~]#
```

Bắt được 128 gói tin

![Imgur](https://i.imgur.com/ECYvuPM.png)

Nhìn kết quả ta có thể thấy:

1. User truy vấn đến DNS1 địa chỉ IP của `google.com.` DNS1 bắt đầu truy vấn các ROOT DNS server
2. ROOT DNS server `i.root-servers.net` trả về kết quả các DNS server quản lý `.com`
3. Tiếp tục truy vấn, DNS server `l.gtld-servers.net` trả về kết quả các DNS quản lý `google.com`
4. Cuối cùng `216.239.38.10#53 (ns4.google.com)` trả về IP của webserver google là `172.217.24.78`

Kết quả ta thấy trong các gói tin cũng thấy kết quả tương tự

![Imgur](https://i.imgur.com/QRc02vN.png)

![Imgur](https://i.imgur.com/vQIAvHy.png)

![Imgur](https://i.imgur.com/b8GrB18.png)